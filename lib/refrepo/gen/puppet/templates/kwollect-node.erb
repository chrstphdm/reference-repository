#
# This file was generated from reference-repository.git
# Do not edit this file by hand. Your changes will be overwritten.
#

<%-
cluster.fetch('metrics', []).each {|metric|
  # These are "virtual" metrics available for a node, but collected elsewhere
  next if metric['source']['protocol'] == "wattmetre"
  next if metric['source']['protocol'] == "network_equipment"
  next if metric['source']['protocol'] == "pdu"

  if metric['source']['protocol'] == "ipmisensor"
    auth = ipmi_credentials+"@"
  elsif metric['source']['protocol'] == "snmp"
    auth = "public@"
  else
    auth = ""
  end

-%>
- name: <%= metric['name'] %>
  device_id: <%= node_uid %>
  url: <%= metric['source']['protocol'] %>://<%= auth %><%= node_uid %>-bmc.<%= site_uid %>.grid5000.fr/<%= metric['source']['id'] %>
  labels: <%= metric.fetch('labels', {}).update({'_device_alias': node_uid+'-bmc'}).to_json %>
  update_every: <%= metric['period'] > 0 ? metric['period'] : metric['optional_period'] %>
<%- if metric['period'] == 0 -%>
  optional: true
<%- end -%>
<%- if metric.has_key?('scale_factor') -%>
  scale_factor: <%= metric['scale_factor'] %>
<%- end -%>

<%-
}
-%>


# INSTALLED BY PUPPET, GENERATED by reference-repo generators
# Module:: dhcpg5k
# File:: puppet:///modules/dhcpg5k/<%= data.fetch('site_uid') %>/dhcpd.conf.d/<%= data.fetch('filename') %>
#
<%
  site_uid = data.fetch('site_uid')

  data.fetch('network_interfaces').each { |network_interface|
    data.fetch('nodes').sort_by { |item| item.to_s.split(/(\d+)/).map { |e| [e.to_i, e] } }.each { |node_uid, node_hash| 
      network_interface != 'bmc' ? node_uid_net = node_uid : node_uid_net = node_uid + '-bmc'

      # Get ip and mac addresses
      begin
        node_ip, node_mac = get_network_info(node_hash, network_interface)
      rescue => e
        # Hash.fetch(key) raise KeyError if the hash[key] does not exist.
        puts "Error in #{__method__}: #{e}. Skip the DHCP entry for #{node_uid} at #{site_uid} (#{network_interface})."
        next
      end

%>
host <%= node_uid_net %>.<%= site_uid %>.grid5000.fr {
  hardware ethernet       <%= node_mac.upcase %>;
  fixed-address           <%= node_ip         %>;
}
<%   } %>
<% }   %>

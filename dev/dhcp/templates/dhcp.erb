# INSTALLED BY PUPPET, GENERATED by reference-repo generators
# Module:: dhcpg5k
# File:: puppet:///modules/dhcpg5k/<%= data.fetch('site_uid') %>/dhcpd.conf.d/<%= data.fetch('filename') %>
#
<%
  site_uid = data.fetch('site_uid')

  data.fetch('network_adapters').each { |network_interface|
%>
group {
<%
    data.fetch('nodes').each_sort_by_node_uid { |node_uid, node_hash| 
      network_interface != 'bmc' ? node_uid_net = node_uid : node_uid_net = node_uid + '-bmc'

      # Get ip and mac addresses
      begin
        node_ip, node_mac = get_network_info(node_hash, network_interface)
      rescue => e
        # Hash.fetch(key) raise KeyError if the hash[key] does not exist.
        puts "Error in #{__method__}: #{e}. Skip the DHCP entry for #{node_uid} at #{site_uid} (#{network_interface})."
        next
      end

%>
  host <%= node_uid_net %>.<%= site_uid %>.grid5000.fr {
    hardware ethernet       <%= node_mac.upcase %>;
    fixed-address           <%= node_ip         %>;
  }
<%   } %>
}
<% }   %>
